<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Bitu Chat</title>
    <style>
        /* Bot칩n flotante */
        #bitu-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #4a4a4a;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        /* Ventana de chat */
        #bitu-chat {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 320px;
            max-height: 400px;
            background-color: #f2f2f2;
            border-radius: 10px;
            box-shadow: 0px 4px 12px rgba(0,0,0,0.2);
            display: none;
            flex-direction: column;
            z-index: 1000;
        }

        #bitu-chat-header {
            background-color: #333;
            color: white;
            padding: 10px;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            font-weight: bold;
        }

        #bitu-messages {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            font-size: 14px;
        }

        .message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 15px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .user {
            background-color: #4a4a4a;
            color: white;
            align-self: flex-end;
        }

        .bot {
            background-color: #d9d9d9;
            color: black;
            align-self: flex-start;
        }

        #bitu-input-container {
            display: flex;
            border-top: 1px solid #ccc;
        }

        #bitu-input {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 0 0 0 10px;
            outline: none;
            font-size: 14px;
        }

        #bitu-send {
            padding: 10px 15px;
            border: none;
            background-color: #4a4a4a;
            color: white;
            cursor: pointer;
            border-radius: 0 0 10px 0;
        }
    </style>
</head>
<body>

<button id="bitu-button">游눫</button>

<div id="bitu-chat">
    <div id="bitu-chat-header">Bitu</div>
    <div id="bitu-messages"></div>
    <div id="bitu-input-container">
        <input type="text" id="bitu-input" placeholder="Escrib칤 tu mensaje...">
        <button id="bitu-send">Enviar</button>
    </div>
</div>

<script>
    const bituButton = document.getElementById("bitu-button");
    const bituChat = document.getElementById("bitu-chat");
    const bituMessages = document.getElementById("bitu-messages");
    const bituInput = document.getElementById("bitu-input");
    const bituSend = document.getElementById("bitu-send");

    // Mostrar/ocultar chat
    bituButton.addEventListener("click", () => {
        bituChat.style.display = bituChat.style.display === "flex" ? "none" : "flex";
        bituChat.style.flexDirection = "column";
    });

    // Funci칩n para enviar mensaje
    async function sendMessage() {
        const message = bituInput.value.trim();
        if (!message) return;

        // Mostrar mensaje del usuario
        const userMsg = document.createElement("div");
        userMsg.classList.add("message", "user");
        userMsg.textContent = message;
        bituMessages.appendChild(userMsg);
        bituInput.value = "";
        bituMessages.scrollTop = bituMessages.scrollHeight;

        try {
            const response = await fetch("https://chatbot-bitu.onrender.com/message", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ message })
            });

            const data = await response.json();
            const botMsg = document.createElement("div");
            botMsg.classList.add("message", "bot");
            botMsg.textContent = data.reply;
            bituMessages.appendChild(botMsg);
            bituMessages.scrollTop = bituMessages.scrollHeight;
        } catch (error) {
            const errorMsg = document.createElement("div");
            errorMsg.classList.add("message", "bot");
            errorMsg.textContent = "Error de conexi칩n. Intenta m치s tarde.";
            bituMessages.appendChild(errorMsg);
        }
    }

    bituSend.addEventListener("click", sendMessage);
    bituInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") sendMessage();
    });
</script>

</body>
</html>
